<!doctype html>

<html lang="en">

<head>
	<title>Computer Algebra Project</title>
	<link rel="stylesheet" type="text/css" href="stylesheets/parser_style.css" media="screen" />
</head>

<body>
	<header>
		<h1>Trigonometric expression parser</h1>
		
		<menu id="control">
			<input id="expression" placeholder="Enter the expression"></input>
			<button id="go">Go</button>
		</menu>
	</header>
	
	<figure id="AST_area"></figure>
	
	<script src="libs/d3.min.js"></script>
	<script src="src/parser.js"></script>
	<script>
		var expr = document.getElementById('expression'),
			btn = document.getElementById('go'),
			output = document.getElementById('AST_area'),
			update = function() {
				console.log('parser out:', parser.parse(expr.value));
			};
		
		btn.addEventListener('click', update);
		expr.addEventListener('change', update);
	
		var astDims = window.getComputedStyle(output),
			w = parseFloat(astDims.getPropertyValue('width')),
			h = parseFloat(astDims.getPropertyValue('height')),
			diameter = Math.min(w, h);
			
		var svg = d3.select('#AST_area').append('svg')
			.attr("width", w).attr("height", h)
			.append("g")
			.attr("transform", "translate(" + w / 2 + "," + h / 2 + ")");

		var tree = d3.layout.tree()
			.size([180, diameter / 2])
			.separation(function(a, b) {
				return (a.parent == b.parent ? 1 : 2) / a.depth;
			});

		var diagonal = d3.svg.diagonal.radial()
			.projection(function(d) {
				return [d.y, d.x / 180 * Math.PI];
			});		

		d3.json("flare.json", function(error, root) {
			var nodes = tree.nodes(root),
				links = tree.links(nodes);

			var link = svg.selectAll(".link")
				.data(links)
				.enter().append("path")
				.attr("class", "link")
				.attr("d", diagonal);

			var node = svg.selectAll(".node")
				.data(nodes)
				.enter().append("g")
				.attr("class", "node")
				.attr("transform", function(d) {
					return "rotate(" + (d.x - 90) + ")translate(" + d.y + ")";
				})

			node.append("circle")
				.attr("r", 4.5);

			node.append("text")
				.attr("dy", ".31em")
				.attr("text-anchor", function(d) {
					return d.x < 180 ? "start" : "end";
				})
				.attr("transform", function(d) {
					return d.x < 180 ? "translate(8)" : "rotate(180)translate(-8)";
				})
				.text(function(d) {
					return d.name;
				});
		});

		d3.select(self.frameElement).style("height", diameter - 150 + "px");
	</script>
</body>

</html>