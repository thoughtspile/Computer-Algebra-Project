<!doctype html>

<html lang="en">

<head>
	<title>Computer Algebra Project</title>
	<link rel="stylesheet" type="text/css" href="stylesheets/parser_style.css" media="screen" />
</head>

<body>
	<header>
		<h1>Trigonometric expression parser</h1>
		
		<menu id="control">
			<input id="expression" placeholder="Enter the expression"></input>
			<button id="go">Go</button>
		</menu>
	</header>
	
	<figure id="AST_area"></figure>
	
	<script src="libs/d3.min.js"></script>
	<script src="src/parser.js"></script>
	<script>
		var expr = document.getElementById('expression'),
			btn = document.getElementById('go'),
			output = document.getElementById('AST_area'),
			update = function() {
				svg.selectAll("*").remove();
				
				var astroot = parser.parse(expr.value),
					astnodes = tree.nodes(astroot),
					astlinks = tree.links(astnodes);				
				
				var link = svg.selectAll(".link")
					.data(astlinks)
					.enter().append("path")
					.attr("class", "link")
					.attr("d", diagonal);

				var node = svg.selectAll(".node")
					.data(astnodes)
					.enter().append("g")
					.attr("class", "node")
					.attr("transform", function(d) {
						return "translate(" + d.x + "," + d.y + ")";
					});

				node.append("circle")
					.attr("r", 2);

				node.append("text")
					.attr("dy", "5pt")
					.attr('dx', '4pt')
					.text(function(d) {
						return d.selfValue;
					});
			},
			fitSVG = function() {
				var astDims = window.getComputedStyle(output),
					w = parseFloat(astDims.getPropertyValue('width')),
					h = parseFloat(astDims.getPropertyValue('height'));
				svg.attr('width', w).attr('height', h);
				tree.size([.8 * w, .9 * h]);
			};
		
		btn.addEventListener('click', update);
		expr.addEventListener('change', update);
		output.addEventListener('resize', fitSVG);			
			
		var svg = d3.select('#AST_area').append('svg')
				.attr('transform', 'translate(0, 10)'),
			tree = d3.layout.tree(),
			diagonal = d3.svg.diagonal.radial();		
		
		fitSVG();
		update();
	</script>
</body>

</html>